АНАЛИЗ РЕЗУЛЬТАТОВ ИССЛЕДОВАНИЯ АЛГОРИТМА HYPERLOGLOG

Этап 1. Инфраструктура

Класс RandomStreamGen генерирует поток строк длиной от 1 до 30 символов. Допустимые символы: латинские буквы (A-Z, a-z), цифры 0-9 и тире. Метод getStreamAtTime(t, totalSize) возвращает префикс потока, соответствующий моменту времени t (от 0 до 1), что позволяет моделировать срезы потока на 10%, 25%, 50%, 75% и 100%.

Класс HashFuncGen реализует хеш-функцию h: U -> M = 2^32. Поддерживаются два варианта: полиномиальный хеш (p=31) и FNV-1a. В экспериментах используется FNV-1a как обеспечивающий более равномерное распределение. Функция uniformityScore позволяет оценить равномерность по критерию хи-квадрат.

Этап 2. Реализация HyperLogLog

Алгоритм HyperLogLog использует m = 2^B регистров. Первые B бит 32-битного хеша определяют индекс субпотока, оставшиеся (32-B) бит используются для вычисления rho (позиция первой единицы плюс один). В оценке применяются константы alpha_m: 0.673 для m=16, 0.697 для m=32, 0.709 для m=64 и 0.7213/(1+1.079/m) для m>=128. При малой кардинальности (E_raw < 2.5*m) включается linear counting: E = m*ln(m/V), где V — число нулевых регистров.

Выбор B обоснован серией прогонов с B=4, 6, 8, 10, 12 на потоках по 8000 элементов (10 запусков). Средняя относительная ошибка убывает с ростом B: при B=4 около 19%, при B=12 около 1.6%. Выбран B=12 (m=4096) как компромисс между точностью и памятью: 4096 байт на регистры при теоретической стандартной ошибке порядка 1.04/sqrt(4096) примерно 1.6%.

Эксперименты проведены на потоках размером 1000, 5000, 10000 и 20000 элементов. Для каждого размера рассмотрены срезы при t = 10%, 25%, 50%, 75%, 100%. По 15 прогонам с разными seed вычислены E(Ft0), E(Nt) и sigma_Nt. График 1 показывает сравнение точного Ft0 и оценки Nt на одном потоке (seed=42) для каждого размера. График 2 отображает E(Nt) и область неопределённости E(Nt) плюс-минус sigma_Nt.

Этап 3. Анализ точности и стабильности

Точность. Теоретическая относительная стандартная ошибка для HyperLogLog равна 1.04/sqrt(m). При m=4096 получаем 1.04/64 примерно 0.0163. Более консервативная оценка 1.32/sqrt(m) даёт около 0.0206. Практическая относительная ошибка |E(Nt)-E(Ft0)|/E(Ft0) во всех проведённых экспериментах не превышает 0.006 (0.6%). Во всех случаях она укладывается в пределы как 1.04/sqrt(m), так и 1.32/sqrt(m). Алгоритм обеспечивает запас точности относительно теоретических границ.

Стабильность. Коэффициент вариации CV = sigma_Nt/E(Nt) характеризует относительный разброс оценки. В экспериментах CV варьируется от 0.0076 до 0.0189. Для больших потоков и полных срезов (t=100%) CV обычно 1–2%. Оценка стабильна: стандартное отклонение составляет порядка одного процента от среднего значения.

Константы. Использованные alpha_m взяты из классической работы Flajolet et al. и корректируют смещение гармонического среднего. Для m>=128 применяется приближённая формула 0.7213/(1+1.079/m). Порог 2.5*m для переключения на linear counting выбран стандартно: при малой кардинальности raw-оценка HyperLogLog завышена из-за малого числа ненулевых регистров, а linear counting даёт более точный результат. Влияние констант положительное: практическая ошибка заметно ниже теоретической границы, что свидетельствует об адекватности выбора.

Вывод. Реализованный HyperLogLog обеспечивает оценку Ft0 с относительной ошибкой менее одного процента в среднем и стабильностью в пределах 2%. Результаты согласуются с теоретическими оценками 1.04/sqrt(m) и 1.32/sqrt(m). Выбор B=12 и стандартных констант alpha_m, а также применение linear counting при малой кардинальности, является эффективным.
